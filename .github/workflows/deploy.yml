on:
  workflow_call:

jobs:
  publish-docker-images:
    runs-on: ubuntu-22.04
    strategy:
      matrix:
        project: [
          basic-stream-service
        ]
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/deploy/publish-docker-images
        with:
          project: ${{ matrix.project }}
          DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
  publish-npm-package:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/deploy/publish-npm-package
        with:
          project: grpc-proto-shared
          before_hook_cmd: 'npm run proto:generate'
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
  deploy-production-vercel-webapp:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/deploy/vercel
        with:
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
          VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
